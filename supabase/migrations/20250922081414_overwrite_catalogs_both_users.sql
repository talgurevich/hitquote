-- Script to overwrite catalogs for both users with bread station catalog
-- This script clears existing data and inserts the new bread station catalog

-- Temporarily disable RLS for this migration
SET row_security = off;

DO $$
DECLARE
    tal_user_id UUID;
    moran_user_id UUID;
BEGIN
    -- Get user IDs from auth.users table
    SELECT id INTO tal_user_id FROM auth.users WHERE email = 'tal.gurevich@gmail.com';
    SELECT id INTO moran_user_id FROM auth.users WHERE email = 'moran.marmus@gmail.com';
    
    -- Verify both users exist
    IF tal_user_id IS NULL THEN
        RAISE EXCEPTION 'Could not find user ID for tal.gurevich@gmail.com';
    END IF;
    
    IF moran_user_id IS NULL THEN
        RAISE EXCEPTION 'Could not find user ID for moran.marmus@gmail.com';
    END IF;
    
    RAISE NOTICE 'Found Tal user ID: %', tal_user_id;
    RAISE NOTICE 'Found Moran user ID: %', moran_user_id;
    
    -- Clear existing data for both users (delete in correct order due to foreign keys)
    RAISE NOTICE 'Clearing existing data...';
    
    -- Delete proposal items first
    DELETE FROM proposal_item WHERE tenant_id IN (tal_user_id, moran_user_id);
    -- Delete proposals 
    DELETE FROM proposal WHERE tenant_id IN (tal_user_id, moran_user_id);
    -- Delete products
    DELETE FROM product WHERE tenant_id IN (tal_user_id, moran_user_id);
    -- Delete customers
    DELETE FROM customer WHERE tenant_id IN (tal_user_id, moran_user_id);
    -- Delete settings
    DELETE FROM settings WHERE tenant_id IN (tal_user_id, moran_user_id);
    
    RAISE NOTICE 'Uploading bread station catalog to both accounts...';
    
    -- Insert bread station catalog for Tal
    INSERT INTO product (tenant_id, category, name, unit_label, base_price, notes, options) VALUES
    (tal_user_id, 'כריכונים', 'מיני קרואסנדוויץ׳', '16 יח׳', 168.00, 'ניתן לשלב 2 סוגים במגש', 'גאודה | סלט ביצים'),
    (tal_user_id, 'כריכונים', 'כריכונים בלחם כוסמין פרוס', '18 יח׳', 190.00, 'ניתן לשלב 2 סוגים במגש', 'טונה | סלט ביצים | אנטיפסטי ובולגרית | חציל וביצה | חביתה'),
    (tal_user_id, 'כריכונים', 'כריכונים במיני בריוש', '12 יח׳', 150.00, 'ניתן לשלב 2 סוגים במגש', 'טונה | סלט ביצים | אנטיפסטי ובולגרית | חציל וביצה | חביתה'),
    (tal_user_id, 'כריכונים', 'כריכונים בפרעצל', '12 יח׳', 162.00, 'ניתן לשלב 2 סוגים במגש', 'טונה | סלט ביצים | אנטיפסטי ובולגרית | חציל וביצה | חביתה'),
    (tal_user_id, 'כריכונים - פרימיום', 'כריכונים פרימיום בפרעצל', '12 יח׳', 210.00, 'ניתן לשלב 2 סוגים במגש', 'קפרזה | סלמון | אבוקדו (בעונה)'),
    (tal_user_id, 'כריכונים - פרימיום', 'כריכונים במיני פרעצל פרימיום', '12 יח׳', 220.00, '', 'חלומי'),
    (tal_user_id, 'כריכונים - פרימיום', 'כריכונים בייגל אמריקאי חצוי', '12 יח׳', 180.00, '', 'גאודה | סלט ביצים | סלמון (+42)'),
    (tal_user_id, 'כריכונים - פרימיום', 'כריכונים בייגל אמריקאי חצוי פרימיום', '12 יח׳', 220.00, 'ניתן לשלב 2 סוגים במגש', 'קפרזה | סלמון | אבוקדו (בעונה)'),
    (tal_user_id, 'מאפים מלוחים', 'לחמים ומטבל', 'מגש', 98.00, 'ניתן לשלב 3 סוגים', 'שיפון | אגוזים | זיתים | אגוזים צימוקים | דגנים | כוסמין'),
    (tal_user_id, 'מאפים מלוחים', 'ירקות אנטיפסטי', 'מגש', 145.00, '', 'חצילים בטטה בצל סגול זוקיני פלפל אדום שרי'),
    (tal_user_id, 'מאפים מלוחים', 'ירקות טריים', 'מגש', 120.00, '', 'מלפפון פלפלים צבעוניים גזר שרי צנונית זיתי קלמטה בזיליקום'),
    (tal_user_id, 'מאפים מלוחים', 'מאפים מלוחים (28-34 יח׳)', 'מגש', 125.00, '', 'גבינה | תפו״א | פטריות | פריך גבינה | פריך תרד וגבינה | פיצה'),
    (tal_user_id, 'סלטים גדולים', 'סלט בולגרית', 'מגש', 135.00, '', 'תערובת חסות מלפפון עגבניות שרי זיתי קלמטה בצל סגול נענע שמן זית זעתר קרוטונים'),
    (tal_user_id, 'סלטים גדולים', 'סלט בולגרית עם פטה', 'מגש', 139.00, '', 'תערובת חסות מלפפון עגבניות שרי זיתי קלמטה בצל סגול שמן זית לימון זעתר פטה'),
    (tal_user_id, 'סלטים גדולים', 'סלט קיסר', 'מגש', 139.00, '', 'חסה קיסר ביצה שבבי פרמזן קרוטונים בצל סגול רוטב קיסר'),
    (tal_user_id, 'סלטים גדולים', 'סלט קיסר פרימיום', 'מגש', 145.00, '', 'חסה קיסר שרי ביצה שבבי פרמזן קרוטונים רוטב קיסר'),
    (tal_user_id, 'סלטים גדולים', 'סלט מוצרלה', 'מגש', 145.00, '', 'חסות ועלים שרי זיתי קלמטה בזיליקום תפוז אגוזי מלך בלסמי מצומצם'),
    (tal_user_id, 'סלטים גדולים', 'סלט קינואה ועדשים', 'מגש', 155.00, '', 'תערובת חסות קוביות בטטה עגבניות שרי עדשים קינואה שקדים קלוים רוטב אסיאטי'),
    (tal_user_id, 'סלטים גדולים', 'סלט פסטה', 'מגש', 155.00, '', 'תערובת חסות עגבניות שרי פלפל קלוי קוביות בטטה גבינת פטה שמן זית לימון'),
    (tal_user_id, 'סלטים גדולים', 'סלט טונה', 'מגש', 155.00, '', 'תערובת חסות עגבניות שרי מלפפון סלט טונה ביצה קשה זיתי קלמטה שמן זית לימון'),
    (tal_user_id, 'סלטים גדולים', 'סלט קפרזה', 'מגש', 155.00, '', 'תערובת חסות עגבניות שרי בצל סגול בייבי מוצרלה שמן זית לימון חומץ בלסמי מצומצם'),
    (tal_user_id, 'סלטים גדולים', 'סלט חלומי', 'מגש', 155.00, '', 'תערובת חסות עגבניות שרי מלפפון בצל סגול קוביות בטטה זיתי קלמטה חלומי פטה שמן זית לימון זעתר'),
    (tal_user_id, 'סלטים גדולים', 'סלט נבטים אסיאטי', 'מגש', 155.00, '', 'רצועות כרוב וגזר אטריות שעועית נבטים נענע כוסברה פקאן בוטנים קשיו שומשום קצח רוטב אסיאטי'),
    (tal_user_id, 'מגשי אירוח', 'סלמון', 'מגש', 200.00, '', 'שמנת מלפפון צנונית עלים'),
    (tal_user_id, 'מגשי אירוח', 'סלט ביצים', 'מגש', 180.00, '', 'חמוצים עגבניה עלים'),
    (tal_user_id, 'מגשי אירוח', 'גאודה', 'מגש', 180.00, '', 'מלפפון עגבניה עלים'),
    (tal_user_id, 'מגשי אירוח', 'קפרזה', 'מגש', 200.00, '', 'פסטו עגבניה בלסמי בזיליקום'),
    (tal_user_id, 'מאפים מתוקים', 'מאפים מתוקים (20-24 יח׳)', 'מגש', 95.00, 'ניתן לשלב 2 סוגים', 'רוגלך | גביניות | קרואסון חמאה | קרואסון שוקולד | קרואסון קינמון'),
    (tal_user_id, 'מאפים מתוקים', 'רוגלך (32-34 יח׳)', 'מגש', 95.00, '', 'שוקולד'),
    (tal_user_id, 'מאפים מתוקים', 'רוגלך הבית פרימיום (40-45 יח׳)', 'מגש', 198.00, '', 'שוקולד | קינמון | פיסטוק שוקולד לבן | חלווה | שוקולד חלווה | שקדים | פיסטוק | גבינה'),
    (tal_user_id, 'מאפים מתוקים', 'עוגות שמרים', 'מגש', 108.00, 'ניתן לשלב 2 סוגים', 'שוקולד | חלווה'),
    (tal_user_id, 'מאפים מתוקים', 'רולדות פרסבורגר', 'מגש', 125.00, 'ניתן לשלב 2 סוגים', 'פרסבורגר | גבינת ריקוטה'),
    (tal_user_id, 'עוגות ועוגיות', 'בחושות', 'מגש', 105.00, 'ניתן לשלב 2 סוגים', 'שוקולד | תפוז | גזר אגוזים | שיש | לימון | אוכמניות | בננה אגוזים (טבעונית)'),
    (tal_user_id, 'עוגות ועוגיות', 'עוגיות מתוקות', 'מגש', 139.00, '', 'ריבה | שוקולד | אלפחורס | ביסקוטי'),
    (tal_user_id, 'עוגות ועוגיות', 'עוגיות מלוחות', 'מגש', 95.00, '', ''),
    (tal_user_id, 'עוגות ועוגיות', 'בראוניז וכדורי שוקולד', 'מגש', 142.00, '', '20 יח׳ כדורים | 12 קוביות בראוניז'),
    (tal_user_id, 'פירות וגבינות', 'פירות העונה', 'מגש', 195.00, '', ''),
    (tal_user_id, 'פירות וגבינות', 'גבינות', 'מגש', 245.00, '', 'בולגרית | גאודה | קממבר | עיזים מתובל בזעתר | ענבים | אגוזי מלך'),
    (tal_user_id, 'פירות וגבינות', 'כוסות מוזלי', '12 יח׳', 159.00, '', 'פירות טריים וסילאן | פירות יער'),
    
    -- Insert bread station catalog for Moran
    (moran_user_id, 'כריכונים', 'מיני קרואסנדוויץ׳', '16 יח׳', 168.00, 'ניתן לשלב 2 סוגים במגש', 'גאודה | סלט ביצים'),
    (moran_user_id, 'כריכונים', 'כריכונים בלחם כוסמין פרוס', '18 יח׳', 190.00, 'ניתן לשלב 2 סוגים במגש', 'טונה | סלט ביצים | אנטיפסטי ובולגרית | חציל וביצה | חביתה'),
    (moran_user_id, 'כריכונים', 'כריכונים במיני בריוש', '12 יח׳', 150.00, 'ניתן לשלב 2 סוגים במגש', 'טונה | סלט ביצים | אנטיפסטי ובולגרית | חציל וביצה | חביתה'),
    (moran_user_id, 'כריכונים', 'כריכונים בפרעצל', '12 יח׳', 162.00, 'ניתן לשלב 2 סוגים במגש', 'טונה | סלט ביצים | אנטיפסטי ובולגרית | חציל וביצה | חביתה'),
    (moran_user_id, 'כריכונים - פרימיום', 'כריכונים פרימיום בפרעצל', '12 יח׳', 210.00, 'ניתן לשלב 2 סוגים במגש', 'קפרזה | סלמון | אבוקדו (בעונה)'),
    (moran_user_id, 'כריכונים - פרימיום', 'כריכונים במיני פרעצל פרימיום', '12 יח׳', 220.00, '', 'חלומי'),
    (moran_user_id, 'כריכונים - פרימיום', 'כריכונים בייגל אמריקאי חצוי', '12 יח׳', 180.00, '', 'גאודה | סלט ביצים | סלמון (+42)'),
    (moran_user_id, 'כריכונים - פרימיום', 'כריכונים בייגל אמריקאי חצוי פרימיום', '12 יח׳', 220.00, 'ניתן לשלב 2 סוגים במגש', 'קפרזה | סלמון | אבוקדו (בעונה)'),
    (moran_user_id, 'מאפים מלוחים', 'לחמים ומטבל', 'מגש', 98.00, 'ניתן לשלב 3 סוגים', 'שיפון | אגוזים | זיתים | אגוזים צימוקים | דגנים | כוסמין'),
    (moran_user_id, 'מאפים מלוחים', 'ירקות אנטיפסטי', 'מגש', 145.00, '', 'חצילים בטטה בצל סגול זוקיני פלפל אדום שרי'),
    (moran_user_id, 'מאפים מלוחים', 'ירקות טריים', 'מגש', 120.00, '', 'מלפפון פלפלים צבעוניים גזר שרי צנונית זיתי קלמטה בזיליקום'),
    (moran_user_id, 'מאפים מלוחים', 'מאפים מלוחים (28-34 יח׳)', 'מגש', 125.00, '', 'גבינה | תפו״א | פטריות | פריך גבינה | פריך תרד וגבינה | פיצה'),
    (moran_user_id, 'סלטים גדולים', 'סלט בולגרית', 'מגש', 135.00, '', 'תערובת חסות מלפפון עגבניות שרי זיתי קלמטה בצל סגול נענע שמן זית זעתר קרוטונים'),
    (moran_user_id, 'סלטים גדולים', 'סלט בולגרית עם פטה', 'מגש', 139.00, '', 'תערובת חסות מלפפון עגבניות שרי זיתי קלמטה בצל סגול שמן זית לימון זעתר פטה'),
    (moran_user_id, 'סלטים גדולים', 'סלט קיסר', 'מגש', 139.00, '', 'חסה קיסר ביצה שבבי פרמזן קרוטונים בצל סגול רוטב קיסר'),
    (moran_user_id, 'סלטים גדולים', 'סלט קיסר פרימיום', 'מגש', 145.00, '', 'חסה קיסר שרי ביצה שבבי פרמזן קרוטונים רוטב קיסר'),
    (moran_user_id, 'סלטים גדולים', 'סלט מוצרלה', 'מגש', 145.00, '', 'חסות ועלים שרי זיתי קלמטה בזיליקום תפוז אגוזי מלך בלסמי מצומצם'),
    (moran_user_id, 'סלטים גדולים', 'סלט קינואה ועדשים', 'מגש', 155.00, '', 'תערובת חסות קוביות בטטה עגבניות שרי עדשים קינואה שקדים קלוים רוטב אסיאטי'),
    (moran_user_id, 'סלטים גדולים', 'סלט פסטה', 'מגש', 155.00, '', 'תערובת חסות עגבניות שרי פלפל קלוי קוביות בטטה גבינת פטה שמן זית לימון'),
    (moran_user_id, 'סלטים גדולים', 'סלט טונה', 'מגש', 155.00, '', 'תערובת חסות עגבניות שרי מלפפון סלט טונה ביצה קשה זיתי קלמטה שמן זית לימון'),
    (moran_user_id, 'סלטים גדולים', 'סלט קפרזה', 'מגש', 155.00, '', 'תערובת חסות עגבניות שרי בצל סגול בייבי מוצרלה שמן זית לימון חומץ בלסמי מצומצם'),
    (moran_user_id, 'סלטים גדולים', 'סלט חלומי', 'מגש', 155.00, '', 'תערובת חסות עגבניות שרי מלפפון בצל סגול קוביות בטטה זיתי קלמטה חלומי פטה שמן זית לימון זעתר'),
    (moran_user_id, 'סלטים גדולים', 'סלט נבטים אסיאטי', 'מגש', 155.00, '', 'רצועות כרוב וגזר אטריות שעועית נבטים נענע כוסברה פקאן בוטנים קשיו שומשום קצח רוטב אסיאטי'),
    (moran_user_id, 'מגשי אירוח', 'סלמון', 'מגש', 200.00, '', 'שמנת מלפפון צנונית עלים'),
    (moran_user_id, 'מגשי אירוח', 'סלט ביצים', 'מגש', 180.00, '', 'חמוצים עגבניה עלים'),
    (moran_user_id, 'מגשי אירוח', 'גאודה', 'מגש', 180.00, '', 'מלפפון עגבניה עלים'),
    (moran_user_id, 'מגשי אירוח', 'קפרזה', 'מגש', 200.00, '', 'פסטו עגבניה בלסמי בזיליקום'),
    (moran_user_id, 'מאפים מתוקים', 'מאפים מתוקים (20-24 יח׳)', 'מגש', 95.00, 'ניתן לשלב 2 סוגים', 'רוגלך | גביניות | קרואסון חמאה | קרואסון שוקולד | קרואסון קינמון'),
    (moran_user_id, 'מאפים מתוקים', 'רוגלך (32-34 יח׳)', 'מגש', 95.00, '', 'שוקולד'),
    (moran_user_id, 'מאפים מתוקים', 'רוגלך הבית פרימיום (40-45 יח׳)', 'מגש', 198.00, '', 'שוקולד | קינמון | פיסטוק שוקולד לבן | חלווה | שוקולד חלווה | שקדים | פיסטוק | גבינה'),
    (moran_user_id, 'מאפים מתוקים', 'עוגות שמרים', 'מגש', 108.00, 'ניתן לשלב 2 סוגים', 'שוקולד | חלווה'),
    (moran_user_id, 'מאפים מתוקים', 'רולדות פרסבורגר', 'מגש', 125.00, 'ניתן לשלב 2 סוגים', 'פרסבורגר | גבינת ריקוטה'),
    (moran_user_id, 'עוגות ועוגיות', 'בחושות', 'מגש', 105.00, 'ניתן לשלב 2 סוגים', 'שוקולד | תפוז | גזר אגוזים | שיש | לימון | אוכמניות | בננה אגוזים (טבעונית)'),
    (moran_user_id, 'עוגות ועוגיות', 'עוגיות מתוקות', 'מגש', 139.00, '', 'ריבה | שוקולד | אלפחורס | ביסקוטי'),
    (moran_user_id, 'עוגות ועוגיות', 'עוגיות מלוחות', 'מגש', 95.00, '', ''),
    (moran_user_id, 'עוגות ועוגיות', 'בראוניז וכדורי שוקולד', 'מגש', 142.00, '', '20 יח׳ כדורים | 12 קוביות בראוניז'),
    (moran_user_id, 'פירות וגבינות', 'פירות העונה', 'מגש', 195.00, '', ''),
    (moran_user_id, 'פירות וגבינות', 'גבינות', 'מגש', 245.00, '', 'בולגרית | גאודה | קממבר | עיזים מתובל בזעתר | ענבים | אגוזי מלך'),
    (moran_user_id, 'פירות וגבינות', 'כוסות מוזלי', '12 יח׳', 159.00, '', 'פירות טריים וסילאן | פירות יער');
    
    RAISE NOTICE 'Successfully uploaded 39 bread station products to both tal.gurevich@gmail.com and moran.marmus@gmail.com accounts';
    
END $$;

-- Re-enable RLS
SET row_security = on;